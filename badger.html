<!--
  Badger - Badge Generator
  (c) 2025 KoffeinKode. Alle rettigheter reservert.
  Uautorisert kopiering, distribusjon eller endring er forbudt.
  Se medfølgende LISENS-BADGER.md for fullstendige vilkår.
-->
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Badger</title>
<link href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700;900&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;700&display=swap" rel="stylesheet">
<link id="badgeFontLink" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700;900&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script src="https://unpkg.com/qr-code-styling@1.5.0/lib/qr-code-styling.js"></script>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }

  :root {
    --bg: #f5f3f0;
    --surface: #ffffff;
    --border: #1a1a1a;
    --text: #1a1a1a;
    --text-muted: #6b6560;
    --accent: #1a1a1a;
    --mono: 'JetBrains Mono', 'SF Mono', 'Menlo', monospace;
  }

  body {
    font-family: var(--mono);
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
    font-size: 12px;
  }

  .app-header {
    background: var(--surface);
    padding: 16px 28px;
    border-bottom: 2px solid var(--border);
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .app-header h1 {
    font-size: 56px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 3px;
  }

  .container {
    display: flex;
    height: calc(100vh - 52px);
  }

  .sidebar {
    width: 380px;
    min-width: 380px;
    background: var(--surface);
    border-right: 2px solid var(--border);
    display: flex;
    flex-direction: column;
    overflow-y: auto;
  }

  .sidebar-section {
    padding: 20px 24px;
    border-bottom: 1px solid #d4d0cc;
  }

  .sidebar-section h3 {
    font-size: 13px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 2px;
    color: var(--text-muted);
    margin-bottom: 14px;
  }

  .sidebar-section label {
    display: block;
    font-size: 13px;
    color: var(--text-muted);
    margin-bottom: 4px;
    margin-top: 12px;
    text-transform: uppercase;
    letter-spacing: 1px;
  }

  .sidebar-section label:first-of-type {
    margin-top: 0;
  }

  textarea {
    width: 100%;
    height: 160px;
    background: var(--bg);
    border: 1px solid var(--border);
    color: var(--text);
    font-family: var(--mono);
    font-size: 11px;
    padding: 10px;
    resize: vertical;
  }

  textarea:focus {
    outline: none;
    box-shadow: 0 0 0 2px var(--border);
  }

  textarea::placeholder {
    color: #aaa5a0;
  }

  input[type="range"] {
    -webkit-appearance: none;
    appearance: none;
    height: 4px;
    background: var(--border);
    outline: none;
    cursor: pointer;
  }

  input[type="range"]::-webkit-slider-thumb {
    -webkit-appearance: none;
    width: 14px;
    height: 14px;
    background: var(--border);
    border: 2px solid var(--surface);
    box-shadow: 0 0 0 1px var(--border);
    cursor: pointer;
  }

  .format-hint {
    font-size: 13px;
    color: var(--text-muted);
    margin-top: 8px;
    line-height: 1.5;
  }

  input[type="number"], input[type="text"], input[type="url"], select {
    background: var(--bg);
    border: 1px solid var(--border);
    color: var(--text);
    font-family: var(--mono);
    font-size: 12px;
    padding: 6px 8px;
    width: 100%;
  }

  select {
    cursor: pointer;
    appearance: none;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='6'%3E%3Cpath d='M0 0l5 6 5-6z' fill='%231a1a1a'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 8px center;
    padding-right: 24px;
  }

  input:focus, select:focus {
    outline: none;
    box-shadow: 0 0 0 2px var(--border);
  }

  .size-row {
    display: flex;
    gap: 12px;
  }

  .size-row > div { flex: 1; }

  .btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    padding: 8px 16px;
    border: 2px solid var(--border);
    background: var(--surface);
    font-family: var(--mono);
    font-size: 13px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 1.5px;
    cursor: pointer;
    transition: all 0.1s;
    color: var(--text);
  }

  .btn:hover {
    background: var(--border);
    color: var(--surface);
  }

  .btn-primary {
    background: var(--border);
    color: var(--surface);
  }

  .btn-primary:hover {
    background: var(--surface);
    color: var(--border);
  }

  .btn-full {
    width: 100%;
    margin-top: 12px;
  }

  .upload-area {
    border: 1px dashed var(--border);
    padding: 20px;
    text-align: center;
    cursor: pointer;
    transition: all 0.1s;
    position: relative;
    background: var(--bg);
  }

  .upload-area:hover {
    background: var(--border);
    color: var(--surface);
  }

  #logoArea:hover {
    background: #c4d9c4;
    color: var(--text);
    border-color: #6a9a6a;
  }

  .upload-area.has-file {
    border-style: solid;
    background: var(--surface);
  }

  .upload-area .upload-text {
    font-size: 14px;
    display: block;
  }

  .upload-area .upload-filename {
    font-size: 14px;
    font-weight: 700;
    margin-top: 4px;
    display: block;
  }

  .upload-area .upload-hint {
    font-size: 13px;
    color: var(--text-muted);
    margin-top: 4px;
    display: block;
  }

  .upload-area input[type="file"] {
    position: absolute;
    inset: 0;
    opacity: 0;
    cursor: pointer;
  }

  .upload-area img {
    max-width: 60px;
    max-height: 60px;
    display: block;
    margin: 0 auto 6px auto;
  }

  .tabs {
    display: flex;
    gap: 0;
    margin-bottom: 14px;
    border: 1px solid var(--border);
  }

  .tab {
    flex: 1;
    padding: 8px;
    text-align: center;
    font-size: 13px;
    font-weight: 700;
    font-family: var(--mono);
    cursor: pointer;
    background: var(--bg);
    color: var(--text-muted);
    border: none;
    text-transform: uppercase;
    letter-spacing: 1px;
    transition: all 0.1s;
  }

  .tab:not(:last-child) { border-right: 1px solid var(--border); }

  .tab.active {
    background: var(--border);
    color: var(--surface);
  }

  .tab-content { display: none; }
  .tab-content.active { display: block; }

  .preview-area {
    flex: 1;
    overflow-y: auto;
    padding: 30px;
    background: var(--bg);
  }

  .preview-area .page {
    width: 210mm;
    height: 297mm;
    margin: 0 auto 24px auto;
    background: white;
    display: flex;
    flex-wrap: wrap;
    align-content: flex-start;
    padding: 10mm;
    gap: 4mm;
    box-shadow: 4px 4px 0 var(--border);
    border: 1px solid var(--border);
  }

  .badge {
    width: 92mm;
    height: 59mm;
    border: 0.3mm solid #ccc;
    overflow: hidden;
    position: relative;
    padding: 5mm;
    background: white;
    color: #000;
  }

  .badge-top {
    position: absolute;
    top: 5mm;
    left: 5mm;
    right: 5mm;
    z-index: 0;
    pointer-events: none;
  }

  .badge-top .logo-img {
    height: auto;
    display: block;
    object-fit: contain;
  }

  .badge-bottom {
    position: absolute;
    bottom: 5mm;
    left: 5mm;
    right: 5mm;
    z-index: 1;
  }

  /* Layout A: Klassisk (default) */
  .badge--layout-a .badge-bottom {
    display: flex;
    align-items: flex-end;
    justify-content: space-between;
    gap: 4mm;
  }

  .badge--layout-a .badge-bottom .qr {
    width: 18mm;
    height: 18mm;
    flex-shrink: 0;
  }

  .badge--layout-a .badge-bottom .qr img {
    width: 100%;
    height: 100%;
    object-fit: contain;
    object-position: left bottom;
  }

  .badge--layout-a .badge-bottom .info {
    text-align: right;
    flex: 1;
  }

  /* Layout C: Speilvendt */
  .badge--layout-c .badge-bottom {
    display: flex;
    align-items: flex-end;
    justify-content: space-between;
    gap: 4mm;
    flex-direction: row-reverse;
  }

  .badge--layout-c .badge-bottom .qr {
    width: 18mm;
    height: 18mm;
    flex-shrink: 0;
  }

  .badge--layout-c .badge-bottom .qr img {
    width: 100%;
    height: 100%;
    object-fit: contain;
    object-position: right bottom;
  }

  .badge--layout-c .badge-bottom .info {
    text-align: left;
    flex: 1;
  }

  /* Badge text styles (default) */
  .badge .info .name {
    font-family: 'Lato', sans-serif;
    font-size: 12pt;
    font-weight: 700;
    color: #000;
    line-height: 1.2;
  }

  .badge .info .commission {
    font-family: 'Lato', sans-serif;
    font-size: 9pt;
    font-weight: 400;
    color: #000;
    line-height: 1.2;
    margin-top: 0.5mm;
  }

  .badge .info .country {
    font-family: 'Lato', sans-serif;
    font-size: 8pt;
    font-weight: 400;
    color: #000;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-top: 0.5mm;
  }

  .badge-count {
    font-size: 11px;
    color: var(--text-muted);
    margin-bottom: 16px;
    text-align: center;
    text-transform: uppercase;
    letter-spacing: 1px;
  }

  .entries-list {
    border: 1px solid var(--border);
    margin-top: 10px;
    max-height: 300px;
    overflow-y: auto;
  }

  .entry-item {
    padding: 8px 10px;
    border-bottom: 1px solid #d4d0cc;
    font-size: 11px;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .entry-item:last-child { border-bottom: none; }

  .entry-item .entry-name { font-weight: 700; font-size: 11px; }
  .entry-item .entry-commission { color: var(--text-muted); font-size: 13px; }
  .entry-item .entry-country { color: var(--text-muted); font-size: 9px; text-transform: uppercase; letter-spacing: 1px; }

  .entry-item .remove-btn {
    background: none;
    border: 1px solid var(--border);
    color: var(--text);
    cursor: pointer;
    font-family: var(--mono);
    font-size: 13px;
    padding: 2px 6px;
    line-height: 1;
    transition: all 0.1s;
  }

  .entry-item .remove-btn:hover {
    background: var(--border);
    color: var(--surface);
  }

  .empty-state {
    text-align: center;
    padding: 80px 30px;
    color: var(--text-muted);
  }

  .empty-state p {
    font-size: 12px;
    line-height: 1.8;
    max-width: 300px;
    margin: 0 auto;
  }

  /* Layout selector */
  .layout-row {
    display: flex;
    gap: 6px;
  }

  .layout-btn {
    flex: 1;
    padding: 8px 4px;
    border: 2px solid var(--border);
    background: var(--bg);
    font-family: var(--mono);
    font-size: 9px;
    font-weight: 700;
    cursor: pointer;
    text-align: center;
    transition: all 0.1s;
    color: var(--text);
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .layout-btn:hover {
    background: #e8e5e2;
  }

  .layout-btn.active {
    background: var(--border);
    color: var(--surface);
  }

  .layout-btn .layout-icon {
    display: block;
    font-size: 16px;
    margin-bottom: 4px;
    line-height: 1;
  }

  /* QR style selector */
  .qr-style-row {
    display: flex;
    gap: 6px;
    margin-top: 10px;
  }

  .qr-style-btn {
    flex: 1;
    padding: 7px 4px;
    border: 1px solid var(--border);
    background: var(--bg);
    font-family: var(--mono);
    font-size: 9px;
    font-weight: 700;
    cursor: pointer;
    text-align: center;
    transition: all 0.1s;
    color: var(--text);
  }

  .qr-style-btn:hover { background: #e8e5e2; }

  .qr-style-btn.active {
    background: var(--border);
    color: var(--surface);
  }

  /* QR color inputs */
  .qr-color-row {
    display: flex;
    gap: 12px;
    margin-top: 10px;
  }

  .qr-color-row > div {
    flex: 1;
  }

  .qr-color-row input[type="color"] {
    width: 100%;
    height: 30px;
    border: 1px solid var(--border);
    background: var(--bg);
    cursor: pointer;
    padding: 2px;
  }

  .qr-color-row input[type="color"]::-webkit-color-swatch-wrapper { padding: 0; }
  .qr-color-row input[type="color"]::-webkit-color-swatch { border: none; }

  /* Font size row */
  .font-size-row {
    display: flex;
    gap: 8px;
  }

  .font-size-row > div { flex: 1; }

  .excel-columns {
    margin-top: 10px;
    padding: 10px;
    background: var(--bg);
    border: 1px solid #d4d0cc;
    font-size: 13px;
    line-height: 1.7;
    color: var(--text-muted);
  }

  .excel-columns strong {
    color: var(--text);
    font-weight: 700;
  }

  @media print {
    * { -webkit-print-color-adjust: exact; print-color-adjust: exact; }
    html, body {
      background: white;
      margin: 0;
      padding: 0;
      width: 210mm;
      height: auto;
      overflow: visible;
    }
    .app-header, .sidebar, .badge-count, .empty-state { display: none !important; }
    .container {
      display: block;
      width: auto;
      height: auto;
      overflow: visible;
    }
    .preview-area {
      padding: 0;
      margin: 0;
      background: white;
      overflow: visible;
      width: auto;
      height: auto;
    }
    .preview-area .page {
      width: 210mm;
      height: 297mm;
      box-shadow: none;
      border: none;
      margin: 0;
      padding: 10mm;
      overflow: visible;
      page-break-after: always;
      break-after: page;
      page-break-inside: avoid;
      break-inside: avoid;
    }
    .preview-area .page:last-child {
      page-break-after: auto;
      break-after: auto;
    }
    .badge {
      border: 0.2mm solid #ccc;
      page-break-inside: avoid;
      break-inside: avoid;
    }
  }

  @page {
    size: A4;
    margin: 0;
  }
</style>
</head>
<body>

<div class="app-header">
  <div style="display:flex;align-items:center;gap:10px">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" width="96" height="96" fill="none" stroke="#1a1a1a" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><path d="M32 18 C28 10, 22 12, 26 22"/><path d="M68 18 C72 10, 78 12, 74 22"/><path d="M26 22 C24 30, 22 38, 30 50 L44 68"/><path d="M74 22 C76 30, 78 38, 70 50 L56 68"/><path d="M38 20 C42 32, 44 46, 46 64"/><path d="M62 20 C58 32, 56 46, 54 64"/><path d="M46 64 C46 68, 48 72, 50 72 C52 72, 54 68, 54 64"/><path d="M44 68 C46 74, 48 76, 50 76 C52 76, 54 74, 56 68"/><ellipse cx="50" cy="68" rx="4" ry="3" fill="#1a1a1a" stroke="none"/><circle cx="39" cy="42" r="3" fill="#1a1a1a" stroke="none"/><circle cx="61" cy="42" r="3" fill="#1a1a1a" stroke="none"/></svg>
    <h1>Badger</h1>
  </div>
  <button class="btn btn-primary" onclick="printBadges()">Eksporter</button>
</div>

<div class="container">
  <div class="sidebar">

    <!-- 0. Skiltformat -->
    <div class="sidebar-section">
      <h3>Skiltformat</h3>
      <div class="size-row">
        <div>
          <label>Bredde mm</label>
          <input type="number" id="badgeWidth" value="92" onchange="renderBadges()">
        </div>
        <div>
          <label>Hoyde mm</label>
          <input type="number" id="badgeHeight" value="59" onchange="renderBadges()">
        </div>
      </div>
    </div>

    <!-- 1. Logo -->
    <div class="sidebar-section">
      <h3>Logo</h3>
      <div class="upload-area" id="logoArea" style="background:#f0f7f0;border-color:#8cb88c">
        <span class="upload-text">Last opp logo</span>
        <span class="upload-hint">.png / .jpg</span>
        <input type="file" accept="image/*" onchange="loadLogo(event)">
      </div>
      <div class="format-hint">
        Min. 300px bredde for god utskriftskvalitet.
      </div>
      <div id="logoControls" style="display:none">
        <label>Bredde</label>
        <div style="display:flex;align-items:center;gap:10px">
          <input type="range" id="logoWidth" min="20" max="100" value="100" oninput="updateLogoWidth()" style="flex:1">
          <span id="logoWidthVal" style="font-size:11px;min-width:32px">100%</span>
        </div>
        <label>Justering</label>
        <div class="layout-row">
          <button class="layout-btn" data-align="left" onclick="setLogoAlign('left', this)">Venstre</button>
          <button class="layout-btn active" data-align="center" onclick="setLogoAlign('center', this)">Sentrert</button>
          <button class="layout-btn" data-align="right" onclick="setLogoAlign('right', this)">H&oslash;yre</button>
        </div>
      </div>
    </div>

    <!-- 2. QR-kode med Generer/Last opp tabs -->
    <div class="sidebar-section">
      <h3>QR-kode</h3>
        <label style="margin-top:0">URL</label>
        <input type="url" id="qrUrl" placeholder="https://example.com" oninput="generateQR()">
        <div style="margin-top:10px">
          <label>Farge</label>
          <input type="color" id="qrColor" value="#000000" onchange="generateQR()" style="width:30px;height:30px;border:1px solid var(--border);background:var(--bg);cursor:pointer;padding:2px">
        </div>
        <div class="qr-style-row">
          <button class="qr-style-btn active" data-style="square" onclick="setQrStyle('square', this)">&#9632; Kantet</button>
          <button class="qr-style-btn" data-style="dots" onclick="setQrStyle('dots', this)">&#9679; Prikker</button>
          <button class="qr-style-btn" data-style="rounded" onclick="setQrStyle('rounded', this)">&#9673; Avrundet</button>
        </div>
        <div id="qrPreview" style="margin-top:12px;text-align:center"></div>
    </div>

    <!-- 3. Deltakere -->
    <div class="sidebar-section">
      <h3>Deltakere</h3>

      <div class="tabs">
        <button class="tab active" onclick="switchTab('excel', this)">Regneark</button>
        <button class="tab" onclick="switchTab('text', this)">Tekst</button>
      </div>

      <div class="tab-content active" id="tab-excel">
        <div class="upload-area" id="excelArea">
          <span class="upload-text">Last opp regneark</span>
          <span class="upload-hint">.xlsx / .csv</span>
          <input type="file" accept=".xlsx,.xls,.csv" onchange="loadExcel(event)">
        </div>
        <div class="excel-columns">
          Tre kolonner: <strong>Navn</strong>, <strong>Stilling</strong>, <strong>Firma</strong>
        </div>
      </div>

      <div class="tab-content" id="tab-text">
        <label>Navn, stilling og firma &mdash; tre linjer per person</label>
        <textarea id="inputList" placeholder="Runi Hagen&#10;Seniorr&aring;dgiver&#10;Nord Universitet&#10;&#10;Ola Nordmann&#10;Daglig leder&#10;Firma AS" oninput="parseTextInput()"></textarea>
      </div>
    </div>

    <!-- 4. Layout -->
    <div class="sidebar-section design-section" style="display:none">
      <h3>Layout</h3>
      <div class="layout-row">
        <button class="layout-btn active" data-layout="a" onclick="setLayout('a', this)">
          <span class="layout-icon">&#9638;</span>H&oslash;yrestilt
        </button>
        <button class="layout-btn" data-layout="c" onclick="setLayout('c', this)">
          <span class="layout-icon">&#9639;</span>Venstrestilt
        </button>
      </div>
      <div class="format-hint" id="layoutDesc">H&oslash;yrestilt &mdash; QR venstre, info h&oslash;yre</div>
    </div>

    <!-- 5. Skrift -->
    <div class="sidebar-section design-section" style="display:none">
      <h3>Skrift</h3>
      <label style="margin-top:0">Font</label>
      <select id="fontSelect" onchange="changeFont()">
        <option value="Lato" selected>Lato</option>
        <option value="Inter">Inter</option>
        <option value="Roboto">Roboto</option>
        <option value="Open Sans">Open Sans</option>
        <option value="Playfair Display">Playfair Display</option>
        <option value="Merriweather">Merriweather</option>
        <option value="Oswald">Oswald</option>
        <option value="Montserrat">Montserrat</option>
      </select>
      <div class="font-size-row" style="margin-top:12px">
        <div>
          <label>Navn pt</label>
          <input type="number" id="fontSize_name" value="18" min="6" max="30" onchange="renderBadges()">
        </div>
        <div>
          <label>Stilling pt</label>
          <input type="number" id="fontSize_commission" value="12" min="5" max="24" onchange="renderBadges()">
        </div>
        <div>
          <label>Firma pt</label>
          <input type="number" id="fontSize_company" value="9" min="5" max="20" onchange="renderBadges()">
        </div>
      </div>
    </div>


    <!-- 7. Liste -->
    <div class="sidebar-section">
      <div style="display:flex;justify-content:space-between;align-items:baseline;margin-bottom:10px">
        <h3 id="entriesHeader" style="margin-bottom:0">Liste (0)</h3>
        <button class="btn" onclick="clearAll()" style="padding:4px 8px;font-size:9px">Nullstill</button>
      </div>
      <div class="entries-list" id="entriesList"></div>
    </div>

  </div>

  <div class="preview-area" id="previewArea">
    <div class="empty-state">
    </div>
  </div>
</div>

<script>const a0_0x5188f2=a0_0x11a3;(function(_0x512126,_0x5b200e){const _0x5da069=a0_0x11a3,_0x14f39e=_0x512126();while(!![]){try{const _0x99f6f2=-parseInt(_0x5da069(0xa3))/0x1+-parseInt(_0x5da069(0xcf))/0x2*(parseInt(_0x5da069(0x100))/0x3)+parseInt(_0x5da069(0xd3))/0x4+parseInt(_0x5da069(0x99))/0x5+-parseInt(_0x5da069(0xbb))/0x6*(-parseInt(_0x5da069(0xab))/0x7)+parseInt(_0x5da069(0x125))/0x8+parseInt(_0x5da069(0x10f))/0x9*(-parseInt(_0x5da069(0x104))/0xa);if(_0x99f6f2===_0x5b200e)break;else _0x14f39e['push'](_0x14f39e['shift']());}catch(_0x522562){_0x14f39e['push'](_0x14f39e['shift']());}}}(a0_0x4d11,0x73bc1));let entries=[],qrDataUrl=null,logoDataUrl=null,currentLayout='a',currentFont=a0_0x5188f2(0xe1),qrDotStyle='square',qrCodeInstance=null,logoWidthPct=0x64,logoAlign=a0_0x5188f2(0xc9);const layoutDescriptions={'a':a0_0x5188f2(0xf1),'c':'Venstrestilt\x20—\x20info\x20venstre,\x20QR\x20høyre'};function loadLogo(_0x5bc9e9){const _0x18f5e9=a0_0x5188f2,_0x26876e=_0x5bc9e9[_0x18f5e9(0xe4)][_0x18f5e9(0xef)][0x0];if(!_0x26876e)return;const _0x51d774=new FileReader();_0x51d774[_0x18f5e9(0x98)]=function(_0x3a7291){const _0x54d837=_0x18f5e9;logoDataUrl=_0x3a7291[_0x54d837(0xe4)][_0x54d837(0xd8)];const _0x1b2cf3=document[_0x54d837(0xc5)]('logoArea');_0x1b2cf3['classList']['add'](_0x54d837(0xdf)),_0x1b2cf3[_0x54d837(0xf3)]=_0x54d837(0x110)+logoDataUrl+'\x22\x20alt=\x22Logo\x22\x20style=\x22max-width:200px;max-height:50px\x22>\x0a\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22upload-filename\x22>'+esc(_0x26876e[_0x54d837(0xea)])+_0x54d837(0xee),document[_0x54d837(0xc5)](_0x54d837(0xed))['style'][_0x54d837(0xda)]='',renderBadges();},_0x51d774[_0x18f5e9(0xaa)](_0x26876e);}const countryMap={'faroe':a0_0x5188f2(0x9d),'finland':'Finland','finnish':'Finland','tampere':a0_0x5188f2(0xe2),'lapland':a0_0x5188f2(0xe2),'greenland':'Greenland','film\x20gl':a0_0x5188f2(0x102),'iceland':a0_0x5188f2(0xde),'norway':a0_0x5188f2(0xac),'norwegian':a0_0x5188f2(0xac),'oslo':a0_0x5188f2(0xac),'arktisk':a0_0x5188f2(0xac),'midgard':a0_0x5188f2(0xac),'western\x20norway':a0_0x5188f2(0xac),'eastern\x20norway':a0_0x5188f2(0xac),'sweden':'Sweden','swedish':a0_0x5188f2(0x10b),'stockholm':a0_0x5188f2(0x10b),'gotland':a0_0x5188f2(0x10b),'åland':a0_0x5188f2(0xb4),'film.ax':a0_0x5188f2(0xb4),'denmark':a0_0x5188f2(0x120),'danish':a0_0x5188f2(0x120),'vision\x20denmark':a0_0x5188f2(0x120),'north\x20finland':a0_0x5188f2(0xe2),'west\x20finland':'Finland','east\x20finland':'Finland','southern\x20sweden':a0_0x5188f2(0x10b)};function detectCountry(_0x313c84){const _0x5b809c=a0_0x5188f2,_0x3e97fa=_0x313c84[_0x5b809c(0xb5)]();for(const [_0x47213e,_0x3b1d95]of Object['entries'](countryMap)){if(_0x3e97fa[_0x5b809c(0xf6)](_0x47213e))return _0x3b1d95;}return'';}function switchTab(_0x3d14a4,_0x588274){const _0x44d1bb=a0_0x5188f2,_0x117a2c=_0x588274['closest']('.sidebar-section');_0x117a2c[_0x44d1bb(0xa6)](_0x44d1bb(0xb3))[_0x44d1bb(0xba)](_0x5c7d7b=>_0x5c7d7b['classList'][_0x44d1bb(0xfa)]('active')),_0x117a2c[_0x44d1bb(0xa6)](_0x44d1bb(0xb2))[_0x44d1bb(0xba)](_0x2354b6=>_0x2354b6[_0x44d1bb(0x112)][_0x44d1bb(0xfa)](_0x44d1bb(0x105))),_0x588274[_0x44d1bb(0x112)][_0x44d1bb(0xdb)](_0x44d1bb(0x105)),_0x117a2c['querySelector'](_0x44d1bb(0xfb)+_0x3d14a4)[_0x44d1bb(0x112)]['add'](_0x44d1bb(0x105));}function switchQrTab(_0x188473,_0x1fea2e){const _0x2ae09e=a0_0x5188f2,_0x35d165=_0x1fea2e['closest'](_0x2ae09e(0x11b));_0x35d165[_0x2ae09e(0xa6)]('.tab')['forEach'](_0x2435d7=>_0x2435d7[_0x2ae09e(0x112)][_0x2ae09e(0xfa)]('active')),_0x35d165[_0x2ae09e(0xa6)](_0x2ae09e(0xb2))[_0x2ae09e(0xba)](_0x1665cc=>_0x1665cc['classList']['remove'](_0x2ae09e(0x105))),_0x1fea2e['classList'][_0x2ae09e(0xdb)](_0x2ae09e(0x105)),_0x35d165[_0x2ae09e(0x118)](_0x2ae09e(0xe3)+_0x188473)[_0x2ae09e(0x112)][_0x2ae09e(0xdb)](_0x2ae09e(0x105));}function loadQR(_0x47ab89){const _0x304e70=a0_0x5188f2,_0x4b41e0=_0x47ab89[_0x304e70(0xe4)]['files'][0x0];if(!_0x4b41e0)return;const _0x39dbc8=new FileReader();_0x39dbc8[_0x304e70(0x98)]=function(_0x137c89){const _0x4dbcfd=_0x304e70;qrDataUrl=_0x137c89['target']['result'];const _0x2a01d9=document[_0x4dbcfd(0xc5)](_0x4dbcfd(0xd7));_0x2a01d9[_0x4dbcfd(0x112)]['add'](_0x4dbcfd(0xdf)),_0x2a01d9['innerHTML']=_0x4dbcfd(0x110)+qrDataUrl+_0x4dbcfd(0xc6)+esc(_0x4b41e0[_0x4dbcfd(0xea)])+_0x4dbcfd(0xf5),renderBadges();},_0x39dbc8[_0x304e70(0xaa)](_0x4b41e0);}function setQrStyle(_0x26466a,_0x281bd6){const _0x44d718=a0_0x5188f2;qrDotStyle=_0x26466a,document[_0x44d718(0xa6)](_0x44d718(0xbc))[_0x44d718(0xba)](_0x204bf5=>_0x204bf5[_0x44d718(0x112)][_0x44d718(0xfa)](_0x44d718(0x105))),_0x281bd6[_0x44d718(0x112)][_0x44d718(0xdb)](_0x44d718(0x105)),generateQR();}function generateQR(){const _0x5756ba=a0_0x5188f2,_0x535966=document[_0x5756ba(0xc5)]('qrUrl')['value']['trim'](),_0x440ae0=document[_0x5756ba(0xc5)]('qrPreview');if(!_0x535966){_0x440ae0[_0x5756ba(0xf3)]='',qrDataUrl=null,renderBadges();return;}const _0x3a2f32=document[_0x5756ba(0xc5)]('qrColor')['value'],_0xe1b52c={'square':_0x5756ba(0xc8),'dots':_0x5756ba(0xb6),'rounded':_0x5756ba(0xca)},_0x2fbbd8={'width':0x12c,'height':0x12c,'data':_0x535966,'dotsOptions':{'color':_0x3a2f32,'type':_0xe1b52c[qrDotStyle]||_0x5756ba(0xc8)},'backgroundOptions':{'color':_0x5756ba(0xeb)},'cornersDotOptions':{'color':_0x3a2f32},'cornersSquareOptions':{'color':_0x3a2f32},'qrOptions':{'errorCorrectionLevel':'M'}};qrCodeInstance&&(_0x440ae0['innerHTML']='');qrCodeInstance=new QRCodeStyling(_0x2fbbd8);const _0x5c34f5=document[_0x5756ba(0xe8)](_0x5756ba(0xb8));_0x440ae0['innerHTML']='',_0x440ae0[_0x5756ba(0xb7)](_0x5c34f5),qrCodeInstance[_0x5756ba(0x115)](_0x5c34f5),setTimeout(()=>{const _0x32bd1=_0x5756ba,_0x5b2cb1=_0x5c34f5[_0x32bd1(0x118)](_0x32bd1(0xf9));if(_0x5b2cb1){qrDataUrl=_0x5b2cb1[_0x32bd1(0xc1)](_0x32bd1(0xfe));const _0x15d4f6=document[_0x32bd1(0xe8)](_0x32bd1(0xd2));_0x15d4f6['src']=qrDataUrl,_0x15d4f6[_0x32bd1(0xdd)][_0x32bd1(0x113)]=_0x32bd1(0xbe),_0x440ae0['innerHTML']='',_0x440ae0[_0x32bd1(0xb7)](_0x15d4f6),renderBadges();}},0xc8);}function updateLogoWidth(){const _0x2638d0=a0_0x5188f2;logoWidthPct=document['getElementById'](_0x2638d0(0xb0))[_0x2638d0(0xc3)],document[_0x2638d0(0xc5)](_0x2638d0(0xd9))[_0x2638d0(0xbf)]=logoWidthPct+'%',renderBadges();}function a0_0x4d11(){const _0x31cfd8=['1731dEACzp',':wght@300;400;700;900&display=swap','Greenland','<div\x20class=\x22badge-count\x22>','70XCNzcs','active','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20','<div\x20style=\x22display:flex;justify-content:','</span>\x0a\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22upload-hint\x22>','\x20navneskilt\x20/\x20','fontSelect','Sweden','\x0a\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20<button\x20class=\x22remove-btn\x22\x20onclick=\x22removeEntry(','pt\x22>','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20','1844298xzdWRF','<img\x20src=\x22','<div\x20class=\x22entry-commission\x22>','classList','cssText','</div>','append','splice','toString','querySelector','length','read','.sidebar-section','Firma\x20AS','\x0a\x20\x20\x20\x20\x20\x20\x20\x20','.design-section','.layout-row','Denmark','badge--layout-','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','stilling','badgeFontLink','3093856Ghwfji','onload','1779825mdskRO','\x22><img\x20class=\x22logo-img\x22\x20src=\x22','entriesHeader','\x0a\x20\x20\x20\x20\x20\x20<div\x20class=\x22badge\x20','Faroe\x20Islands','flex-start','fontSize_commission','mm;height:','<div\x20class=\x22page\x22>','title','496406MSVsvX','%;height:auto\x22></div>','Ingen\x20deltakere.\x20Importer\x20data\x20forst.','querySelectorAll','\x20importert</span>\x0a\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22file\x22\x20accept=\x22.xlsx,.xls,.csv\x22\x20onchange=\x22loadExcel(event)\x22>','\x0a\x20\x20\x20\x20<div\x20class=\x22entry-item\x22>\x0a\x20\x20\x20\x20\x20\x20<div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22entry-name\x22>','print','readAsDataURL','721KRszEn','Norway','layoutDesc','firma','<div\x20class=\x22entry-country\x22>','logoWidth','closest','.tab-content','.tab','Åland','toLowerCase','dots','appendChild','div','split','forEach','53178zzWfCI','.qr-style-btn','Stilling','max-width:80px;max-height:80px;border:1px\x20solid\x20#ccc','textContent','Sheets','toDataURL','\x22\x20alt=\x22Logo\x22\x20style=\x22width:','value','badgeHeight','getElementById','\x22\x20alt=\x22QR\x22>\x0a\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22upload-filename\x22>','\x27,sans-serif;font-size:','square','center','rounded','\x22\x20style=\x22width:','trim','ceil','filter','80tmbRXX','readAsArrayBuffer','Fornavn\x20Etternavn','img','3089612rNsEaC','entriesList','\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22badge-bottom\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22qr\x22>','push','qrArea','result','logoWidthVal','display','add','map','style','Iceland','has-file','fontSize_name','Lato','Finland','#qrtab-','target','.layout-btn','endsWith','excelArea','createElement','<div\x20class=\x22commission\x22\x20style=\x22font-family:\x27','name','#ffffff','company','logoControls','</span>\x0a\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22file\x22\x20accept=\x22image/*\x22\x20onchange=\x22loadLogo(event)\x22>','files','join','Høyrestilt\x20—\x20QR\x20venstre,\x20info\x20høyre','<div\x20class=\x22country\x22\x20style=\x22font-family:\x27','innerHTML','decode','</span>\x0a\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22file\x22\x20accept=\x22image/*\x22\x20onchange=\x22loadQR(event)\x22>','includes','href','SheetNames','canvas','remove','#tab-','flex-end','badgeWidth','image/png','Liste\x20('];a0_0x4d11=function(){return _0x31cfd8;};return a0_0x4d11();}function setLogoAlign(_0xbd0748,_0x59274b){const _0xbe27ae=a0_0x5188f2;logoAlign=_0xbd0748,_0x59274b[_0xbe27ae(0xb1)](_0xbe27ae(0x11f))[_0xbe27ae(0xa6)](_0xbe27ae(0xe5))['forEach'](_0x46f553=>_0x46f553[_0xbe27ae(0x112)][_0xbe27ae(0xfa)](_0xbe27ae(0x105))),_0x59274b[_0xbe27ae(0x112)][_0xbe27ae(0xdb)]('active'),renderBadges();}function setLayout(_0x58d257,_0x50108a){const _0x204923=a0_0x5188f2;currentLayout=_0x58d257,document[_0x204923(0xa6)](_0x204923(0xe5))[_0x204923(0xba)](_0x562b15=>_0x562b15[_0x204923(0x112)][_0x204923(0xfa)](_0x204923(0x105))),_0x50108a['classList'][_0x204923(0xdb)](_0x204923(0x105)),document[_0x204923(0xc5)](_0x204923(0xad))[_0x204923(0xf3)]=layoutDescriptions[_0x58d257],renderBadges();}function changeFont(){const _0x40466d=a0_0x5188f2;currentFont=document[_0x40466d(0xc5)](_0x40466d(0x10a))[_0x40466d(0xc3)];const _0x5efd68=document['getElementById'](_0x40466d(0x124)),_0x432a36=currentFont['replace'](/ /g,'+');_0x5efd68[_0x40466d(0xf7)]='https://fonts.googleapis.com/css2?family='+_0x432a36+_0x40466d(0x101),setTimeout(renderBadges,0x64);}function loadExcel(_0xa56d29){const _0x4ee46a=a0_0x5188f2,_0x268219=_0xa56d29[_0x4ee46a(0xe4)][_0x4ee46a(0xef)][0x0];if(!_0x268219)return;const _0x215565=document['getElementById'](_0x4ee46a(0xe7)),_0x4a8b0a=new FileReader();_0x4a8b0a[_0x4ee46a(0x98)]=function(_0x11d262){const _0x427f04=_0x4ee46a,_0x1acb46=new Uint8Array(_0x11d262[_0x427f04(0xe4)][_0x427f04(0xd8)]);let _0x61ba48={'type':'array'};if(_0x268219[_0x427f04(0xea)][_0x427f04(0xb5)]()[_0x427f04(0xe6)]('.csv')){const _0x35f7cc=new TextDecoder('utf-8')[_0x427f04(0xf4)](_0x1acb46),_0x3fa4eb=_0x35f7cc[_0x427f04(0xb9)]('\x0a')[0x0]||'';_0x61ba48['FS']=_0x3fa4eb['includes'](';')?';':',';}const _0xa927fc=XLSX[_0x427f04(0x11a)](_0x1acb46,_0x61ba48),_0x10393a=_0xa927fc[_0x427f04(0xc0)][_0xa927fc[_0x427f04(0xf8)][0x0]],_0x24ac90=XLSX['utils']['sheet_to_json'](_0x10393a,{'header':0x1});let _0x3eb95a=0x0;if(_0x24ac90['length']>0x0){const _0x43c6e2=_0x24ac90[0x0]['map'](_0x547ed6=>(_0x547ed6||'')['toString']()[_0x427f04(0xb5)]()[_0x427f04(0xcc)]());(_0x43c6e2['includes']('navn')||_0x43c6e2[_0x427f04(0xf6)](_0x427f04(0xea))||_0x43c6e2[_0x427f04(0xf6)](_0x427f04(0x123))||_0x43c6e2[_0x427f04(0xf6)](_0x427f04(0xa2))||_0x43c6e2[_0x427f04(0xf6)](_0x427f04(0xae))||_0x43c6e2[_0x427f04(0xf6)]('company'))&&(_0x3eb95a=0x1);}entries=[];for(let _0x3f7789=_0x3eb95a;_0x3f7789<_0x24ac90['length'];_0x3f7789++){const _0x55c7a3=_0x24ac90[_0x3f7789];if(!_0x55c7a3||_0x55c7a3[_0x427f04(0x119)]<0x1)continue;const _0xe2d093=(_0x55c7a3[0x0]||'')[_0x427f04(0x117)]()[_0x427f04(0xcc)]();if(!_0xe2d093)continue;const _0x1fcf43=_0x55c7a3[_0x427f04(0x119)]>=0x2?(_0x55c7a3[0x1]||'')[_0x427f04(0x117)]()[_0x427f04(0xcc)]():'',_0x2d7b32=_0x55c7a3[_0x427f04(0x119)]>=0x3?(_0x55c7a3[0x2]||'')[_0x427f04(0x117)]()[_0x427f04(0xcc)]():'';entries[_0x427f04(0xd6)]({'name':_0xe2d093,'title':_0x1fcf43,'company':_0x2d7b32});}_0x215565[_0x427f04(0x112)][_0x427f04(0xdb)](_0x427f04(0xdf)),_0x215565['innerHTML']='<span\x20class=\x22upload-filename\x22>'+esc(_0x268219[_0x427f04(0xea)])+_0x427f04(0x108)+entries[_0x427f04(0x119)]+_0x427f04(0xa7),renderEntries(),renderBadges();},_0x4a8b0a[_0x4ee46a(0xd0)](_0x268219);}function parseTextInput(){const _0x35a3c2=a0_0x5188f2,_0x36db6a=document[_0x35a3c2(0xc5)]('inputList')[_0x35a3c2(0xc3)][_0x35a3c2(0xcc)]();if(!_0x36db6a)return;const _0x1d882e=_0x36db6a['split']('\x0a')[_0x35a3c2(0xdc)](_0x53f295=>_0x53f295['trim']()['replace'](/,+$/,''))[_0x35a3c2(0xce)](_0x5c9924=>_0x5c9924['length']>0x0);entries=[];for(let _0x49d7d6=0x0;_0x49d7d6<_0x1d882e[_0x35a3c2(0x119)];_0x49d7d6+=0x3){const _0x1f306c=_0x1d882e[_0x49d7d6],_0xe8801=_0x1d882e[_0x49d7d6+0x1]||'',_0x1f329b=_0x1d882e[_0x49d7d6+0x2]||'';_0x1f306c&&entries[_0x35a3c2(0xd6)]({'name':_0x1f306c,'title':_0xe8801,'company':_0x1f329b});}renderEntries(),renderBadges();}function a0_0x11a3(_0x44a28f,_0x265add){_0x44a28f=_0x44a28f-0x98;const _0x4d11a1=a0_0x4d11();let _0x11a341=_0x4d11a1[_0x44a28f];return _0x11a341;}function renderEntries(){const _0x5109be=a0_0x5188f2,_0x4e28b0=document[_0x5109be(0xc5)](_0x5109be(0xd4));document[_0x5109be(0xc5)](_0x5109be(0x9b))['textContent']=_0x5109be(0xff)+entries[_0x5109be(0x119)]+')',_0x4e28b0[_0x5109be(0xf3)]=entries[_0x5109be(0xdc)]((_0x2418d9,_0x56ab15)=>_0x5109be(0xa8)+esc(_0x2418d9[_0x5109be(0xea)])+_0x5109be(0x10e)+(_0x2418d9['title']?_0x5109be(0x111)+esc(_0x2418d9['title'])+_0x5109be(0x114):'')+_0x5109be(0x11d)+(_0x2418d9[_0x5109be(0xec)]?_0x5109be(0xaf)+esc(_0x2418d9['company'])+_0x5109be(0x114):'')+_0x5109be(0x10c)+_0x56ab15+')\x22>x</button>\x0a\x20\x20\x20\x20</div>\x0a\x20\x20')[_0x5109be(0xf0)]('');}function esc(_0x13f76d){const _0x36d5b7=a0_0x5188f2,_0x4604a7=document[_0x36d5b7(0xe8)](_0x36d5b7(0xb8));return _0x4604a7[_0x36d5b7(0xbf)]=_0x13f76d,_0x4604a7[_0x36d5b7(0xf3)];}function removeEntry(_0x32a311){const _0x21c12c=a0_0x5188f2;entries[_0x21c12c(0x116)](_0x32a311,0x1),renderEntries(),renderBadges();}function clearAll(){entries=[],renderEntries(),renderBadges();}function renderBadges(){const _0x132cee=a0_0x5188f2,_0x4b4bda=document[_0x132cee(0xc5)]('previewArea'),_0x3a4d36=document[_0x132cee(0xc5)](_0x132cee(0xfd))[_0x132cee(0xc3)]||0x5c,_0x3223cd=document[_0x132cee(0xc5)](_0x132cee(0xc4))['value']||0x3b,_0x495ec4=document[_0x132cee(0xc5)](_0x132cee(0xe0))[_0x132cee(0xc3)]||0x12,_0xb4a3a2=document[_0x132cee(0xc5)](_0x132cee(0x9f))['value']||0xc,_0x14f5f8=document[_0x132cee(0xc5)]('fontSize_company')[_0x132cee(0xc3)]||0x9,_0x494e91=entries[_0x132cee(0x119)]>0x0||logoDataUrl||qrDataUrl;if(!_0x494e91){_0x4b4bda[_0x132cee(0xf3)]='<div\x20class=\x22empty-state\x22></div>';return;}document[_0x132cee(0xa6)](_0x132cee(0x11e))['forEach'](_0x1ca5fa=>_0x1ca5fa[_0x132cee(0xdd)][_0x132cee(0xda)]='');const _0x2127f0=0x8,_0x2275a8=qrDataUrl?_0x132cee(0x110)+qrDataUrl+'\x22\x20alt=\x22QR\x22>':'',_0x5676cc=_0x132cee(0x121)+currentLayout,_0x590be4={'left':_0x132cee(0x9e),'center':_0x132cee(0xc9),'right':_0x132cee(0xfc)},_0x22afcb=logoDataUrl?_0x132cee(0x107)+_0x590be4[logoAlign]+_0x132cee(0x9a)+logoDataUrl+_0x132cee(0xc2)+logoWidthPct+_0x132cee(0xa4):'',_0x5dc9cd=entries[_0x132cee(0x119)]>0x0?entries:[{'name':_0x132cee(0xd1),'title':_0x132cee(0xbd),'company':_0x132cee(0x11c)}];let _0x19550c=entries[_0x132cee(0x119)]>0x0?_0x132cee(0x103)+entries[_0x132cee(0x119)]+_0x132cee(0x109)+Math[_0x132cee(0xcd)](entries[_0x132cee(0x119)]/_0x2127f0)+'\x20sider</div>':'';for(let _0x56c161=0x0;_0x56c161<_0x5dc9cd['length'];_0x56c161++){if(_0x56c161%_0x2127f0===0x0){if(_0x56c161>0x0)_0x19550c+=_0x132cee(0x114);_0x19550c+=_0x132cee(0xa1);}const _0x34d107=_0x5dc9cd[_0x56c161];_0x19550c+=_0x132cee(0x9c)+_0x5676cc+_0x132cee(0xcb)+_0x3a4d36+_0x132cee(0xa0)+_0x3223cd+'mm;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22badge-top\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+_0x22afcb+_0x132cee(0xd5)+_0x2275a8+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22name\x22\x20style=\x22font-family:\x27'+currentFont+'\x27,sans-serif;font-size:'+_0x495ec4+_0x132cee(0x10d)+esc(_0x34d107['name'])+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+(_0x34d107[_0x132cee(0xa2)]?_0x132cee(0xe9)+currentFont+'\x27,sans-serif;font-size:'+_0xb4a3a2+_0x132cee(0x10d)+esc(_0x34d107['title'])+'</div>':'')+_0x132cee(0x122)+(_0x34d107[_0x132cee(0xec)]?_0x132cee(0xf2)+currentFont+_0x132cee(0xc7)+_0x14f5f8+_0x132cee(0x10d)+esc(_0x34d107[_0x132cee(0xec)])+_0x132cee(0x114):'')+_0x132cee(0x106);}_0x19550c+='</div>',_0x4b4bda[_0x132cee(0xf3)]=_0x19550c;}function printBadges(){const _0x4b8527=a0_0x5188f2;if(entries[_0x4b8527(0x119)]===0x0){alert(_0x4b8527(0xa5));return;}window[_0x4b8527(0xa9)]();}</script>
<script src="https://unpkg.com/qr-code-styling@1.5.0/lib/qr-code-styling.js"></script>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }

  :root {
    --bg: #f5f3f0;
    --surface: #ffffff;
    --border: #1a1a1a;
    --text: #1a1a1a;
    --text-muted: #6b6560;
    --accent: #1a1a1a;
    --mono: 'JetBrains Mono', 'SF Mono', 'Menlo', monospace;
  }

  body {
    font-family: var(--mono);
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
    font-size: 12px;
  }

  .app-header {
    background: var(--surface);
    padding: 16px 28px;
    border-bottom: 2px solid var(--border);
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .app-header h1 {
    font-size: 56px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 3px;
  }

  .container {
    display: flex;
    height: calc(100vh - 52px);
  }

  .sidebar {
    width: 380px;
    min-width: 380px;
    background: var(--surface);
    border-right: 2px solid var(--border);
    display: flex;
    flex-direction: column;
    overflow-y: auto;
  }

  .sidebar-section {
    padding: 20px 24px;
    border-bottom: 1px solid #d4d0cc;
  }

  .sidebar-section h3 {
    font-size: 13px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 2px;
    color: var(--text-muted);
    margin-bottom: 14px;
  }

  .sidebar-section label {
    display: block;
    font-size: 13px;
    color: var(--text-muted);
    margin-bottom: 4px;
    margin-top: 12px;
    text-transform: uppercase;
    letter-spacing: 1px;
  }

  .sidebar-section label:first-of-type {
    margin-top: 0;
  }

  textarea {
    width: 100%;
    height: 160px;
    background: var(--bg);
    border: 1px solid var(--border);
    color: var(--text);
    font-family: var(--mono);
    font-size: 11px;
    padding: 10px;
    resize: vertical;
  }

  textarea:focus {
    outline: none;
    box-shadow: 0 0 0 2px var(--border);
  }

  textarea::placeholder {
    color: #aaa5a0;
  }

  input[type="range"] {
    -webkit-appearance: none;
    appearance: none;
    height: 4px;
    background: var(--border);
    outline: none;
    cursor: pointer;
  }

  input[type="range"]::-webkit-slider-thumb {
    -webkit-appearance: none;
    width: 14px;
    height: 14px;
    background: var(--border);
    border: 2px solid var(--surface);
    box-shadow: 0 0 0 1px var(--border);
    cursor: pointer;
  }

  .format-hint {
    font-size: 13px;
    color: var(--text-muted);
    margin-top: 8px;
    line-height: 1.5;
  }

  input[type="number"], input[type="text"], input[type="url"], select {
    background: var(--bg);
    border: 1px solid var(--border);
    color: var(--text);
    font-family: var(--mono);
    font-size: 12px;
    padding: 6px 8px;
    width: 100%;
  }

  select {
    cursor: pointer;
    appearance: none;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='6'%3E%3Cpath d='M0 0l5 6 5-6z' fill='%231a1a1a'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 8px center;
    padding-right: 24px;
  }

  input:focus, select:focus {
    outline: none;
    box-shadow: 0 0 0 2px var(--border);
  }

  .size-row {
    display: flex;
    gap: 12px;
  }

  .size-row > div { flex: 1; }

  .btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    padding: 8px 16px;
    border: 2px solid var(--border);
    background: var(--surface);
    font-family: var(--mono);
    font-size: 13px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 1.5px;
    cursor: pointer;
    transition: all 0.1s;
    color: var(--text);
  }

  .btn:hover {
    background: var(--border);
    color: var(--surface);
  }

  .btn-primary {
    background: var(--border);
    color: var(--surface);
  }

  .btn-primary:hover {
    background: var(--surface);
    color: var(--border);
  }

  .btn-full {
    width: 100%;
    margin-top: 12px;
  }

  .upload-area {
    border: 1px dashed var(--border);
    padding: 20px;
    text-align: center;
    cursor: pointer;
    transition: all 0.1s;
    position: relative;
    background: var(--bg);
  }

  .upload-area:hover {
    background: var(--border);
    color: var(--surface);
  }

  #logoArea:hover {
    background: #c4d9c4;
    color: var(--text);
    border-color: #6a9a6a;
  }

  .upload-area.has-file {
    border-style: solid;
    background: var(--surface);
  }

  .upload-area .upload-text {
    font-size: 14px;
    display: block;
  }

  .upload-area .upload-filename {
    font-size: 14px;
    font-weight: 700;
    margin-top: 4px;
    display: block;
  }

  .upload-area .upload-hint {
    font-size: 13px;
    color: var(--text-muted);
    margin-top: 4px;
    display: block;
  }

  .upload-area input[type="file"] {
    position: absolute;
    inset: 0;
    opacity: 0;
    cursor: pointer;
  }

  .upload-area img {
    max-width: 60px;
    max-height: 60px;
    display: block;
    margin: 0 auto 6px auto;
  }

  .tabs {
    display: flex;
    gap: 0;
    margin-bottom: 14px;
    border: 1px solid var(--border);
  }

  .tab {
    flex: 1;
    padding: 8px;
    text-align: center;
    font-size: 13px;
    font-weight: 700;
    font-family: var(--mono);
    cursor: pointer;
    background: var(--bg);
    color: var(--text-muted);
    border: none;
    text-transform: uppercase;
    letter-spacing: 1px;
    transition: all 0.1s;
  }

  .tab:not(:last-child) { border-right: 1px solid var(--border); }

  .tab.active {
    background: var(--border);
    color: var(--surface);
  }

  .tab-content { display: none; }
  .tab-content.active { display: block; }

  .preview-area {
    flex: 1;
    overflow-y: auto;
    padding: 30px;
    background: var(--bg);
  }

  .preview-area .page {
    width: 210mm;
    height: 297mm;
    margin: 0 auto 24px auto;
    background: white;
    display: flex;
    flex-wrap: wrap;
    align-content: flex-start;
    padding: 10mm;
    gap: 4mm;
    box-shadow: 4px 4px 0 var(--border);
    border: 1px solid var(--border);
  }

  .badge {
    width: 92mm;
    height: 59mm;
    border: 0.3mm solid #ccc;
    overflow: hidden;
    position: relative;
    padding: 5mm;
    background: white;
    color: #000;
  }

  .badge-top {
    position: absolute;
    top: 5mm;
    left: 5mm;
    right: 5mm;
    z-index: 0;
    pointer-events: none;
  }

  .badge-top .logo-img {
    height: auto;
    display: block;
    object-fit: contain;
  }

  .badge-bottom {
    position: absolute;
    bottom: 5mm;
    left: 5mm;
    right: 5mm;
    z-index: 1;
  }

  /* Layout A: Klassisk (default) */
  .badge--layout-a .badge-bottom {
    display: flex;
    align-items: flex-end;
    justify-content: space-between;
    gap: 4mm;
  }

  .badge--layout-a .badge-bottom .qr {
    width: 18mm;
    height: 18mm;
    flex-shrink: 0;
  }

  .badge--layout-a .badge-bottom .qr img {
    width: 100%;
    height: 100%;
    object-fit: contain;
    object-position: left bottom;
  }

  .badge--layout-a .badge-bottom .info {
    text-align: right;
    flex: 1;
  }

  /* Layout C: Speilvendt */
  .badge--layout-c .badge-bottom {
    display: flex;
    align-items: flex-end;
    justify-content: space-between;
    gap: 4mm;
    flex-direction: row-reverse;
  }

  .badge--layout-c .badge-bottom .qr {
    width: 18mm;
    height: 18mm;
    flex-shrink: 0;
  }

  .badge--layout-c .badge-bottom .qr img {
    width: 100%;
    height: 100%;
    object-fit: contain;
    object-position: right bottom;
  }

  .badge--layout-c .badge-bottom .info {
    text-align: left;
    flex: 1;
  }

  /* Badge text styles (default) */
  .badge .info .name {
    font-family: 'Lato', sans-serif;
    font-size: 12pt;
    font-weight: 700;
    color: #000;
    line-height: 1.2;
  }

  .badge .info .commission {
    font-family: 'Lato', sans-serif;
    font-size: 9pt;
    font-weight: 400;
    color: #000;
    line-height: 1.2;
    margin-top: 0.5mm;
  }

  .badge .info .country {
    font-family: 'Lato', sans-serif;
    font-size: 8pt;
    font-weight: 400;
    color: #000;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-top: 0.5mm;
  }

  .badge-count {
    font-size: 11px;
    color: var(--text-muted);
    margin-bottom: 16px;
    text-align: center;
    text-transform: uppercase;
    letter-spacing: 1px;
  }

  .entries-list {
    border: 1px solid var(--border);
    margin-top: 10px;
    max-height: 300px;
    overflow-y: auto;
  }

  .entry-item {
    padding: 8px 10px;
    border-bottom: 1px solid #d4d0cc;
    font-size: 11px;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .entry-item:last-child { border-bottom: none; }

  .entry-item .entry-name { font-weight: 700; font-size: 11px; }
  .entry-item .entry-commission { color: var(--text-muted); font-size: 13px; }
  .entry-item .entry-country { color: var(--text-muted); font-size: 9px; text-transform: uppercase; letter-spacing: 1px; }

  .entry-item .remove-btn {
    background: none;
    border: 1px solid var(--border);
    color: var(--text);
    cursor: pointer;
    font-family: var(--mono);
    font-size: 13px;
    padding: 2px 6px;
    line-height: 1;
    transition: all 0.1s;
  }

  .entry-item .remove-btn:hover {
    background: var(--border);
    color: var(--surface);
  }

  .empty-state {
    text-align: center;
    padding: 80px 30px;
    color: var(--text-muted);
  }

  .empty-state p {
    font-size: 12px;
    line-height: 1.8;
    max-width: 300px;
    margin: 0 auto;
  }

  /* Layout selector */
  .layout-row {
    display: flex;
    gap: 6px;
  }

  .layout-btn {
    flex: 1;
    padding: 8px 4px;
    border: 2px solid var(--border);
    background: var(--bg);
    font-family: var(--mono);
    font-size: 9px;
    font-weight: 700;
    cursor: pointer;
    text-align: center;
    transition: all 0.1s;
    color: var(--text);
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .layout-btn:hover {
    background: #e8e5e2;
  }

  .layout-btn.active {
    background: var(--border);
    color: var(--surface);
  }

  .layout-btn .layout-icon {
    display: block;
    font-size: 16px;
    margin-bottom: 4px;
    line-height: 1;
  }

  /* QR style selector */
  .qr-style-row {
    display: flex;
    gap: 6px;
    margin-top: 10px;
  }

  .qr-style-btn {
    flex: 1;
    padding: 7px 4px;
    border: 1px solid var(--border);
    background: var(--bg);
    font-family: var(--mono);
    font-size: 9px;
    font-weight: 700;
    cursor: pointer;
    text-align: center;
    transition: all 0.1s;
    color: var(--text);
  }

  .qr-style-btn:hover { background: #e8e5e2; }

  .qr-style-btn.active {
    background: var(--border);
    color: var(--surface);
  }

  /* QR color inputs */
  .qr-color-row {
    display: flex;
    gap: 12px;
    margin-top: 10px;
  }

  .qr-color-row > div {
    flex: 1;
  }

  .qr-color-row input[type="color"] {
    width: 100%;
    height: 30px;
    border: 1px solid var(--border);
    background: var(--bg);
    cursor: pointer;
    padding: 2px;
  }

  .qr-color-row input[type="color"]::-webkit-color-swatch-wrapper { padding: 0; }
  .qr-color-row input[type="color"]::-webkit-color-swatch { border: none; }

  /* Font size row */
  .font-size-row {
    display: flex;
    gap: 8px;
  }

  .font-size-row > div { flex: 1; }

  .excel-columns {
    margin-top: 10px;
    padding: 10px;
    background: var(--bg);
    border: 1px solid #d4d0cc;
    font-size: 13px;
    line-height: 1.7;
    color: var(--text-muted);
  }

  .excel-columns strong {
    color: var(--text);
    font-weight: 700;
  }

  @media print {
    * { -webkit-print-color-adjust: exact; print-color-adjust: exact; }
    html, body {
      background: white;
      margin: 0;
      padding: 0;
      width: 210mm;
      height: auto;
      overflow: visible;
    }
    .app-header, .sidebar, .badge-count, .empty-state { display: none !important; }
    .container {
      display: block;
      width: auto;
      height: auto;
      overflow: visible;
    }
    .preview-area {
      padding: 0;
      margin: 0;
      background: white;
      overflow: visible;
      width: auto;
      height: auto;
    }
    .preview-area .page {
      width: 210mm;
      height: 297mm;
      box-shadow: none;
      border: none;
      margin: 0;
      padding: 10mm;
      overflow: visible;
      page-break-after: always;
      break-after: page;
      page-break-inside: avoid;
      break-inside: avoid;
    }
    .preview-area .page:last-child {
      page-break-after: auto;
      break-after: auto;
    }
    .badge {
      border: 0.2mm solid #ccc;
      page-break-inside: avoid;
      break-inside: avoid;
    }
  }

  @page {
    size: A4;
    margin: 0;
  }
</style>
</head>
<body>

<div class="app-header">
  <div style="display:flex;align-items:center;gap:10px">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" width="96" height="96" fill="none" stroke="#1a1a1a" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><path d="M32 18 C28 10, 22 12, 26 22"/><path d="M68 18 C72 10, 78 12, 74 22"/><path d="M26 22 C24 30, 22 38, 30 50 L44 68"/><path d="M74 22 C76 30, 78 38, 70 50 L56 68"/><path d="M38 20 C42 32, 44 46, 46 64"/><path d="M62 20 C58 32, 56 46, 54 64"/><path d="M46 64 C46 68, 48 72, 50 72 C52 72, 54 68, 54 64"/><path d="M44 68 C46 74, 48 76, 50 76 C52 76, 54 74, 56 68"/><ellipse cx="50" cy="68" rx="4" ry="3" fill="#1a1a1a" stroke="none"/><circle cx="39" cy="42" r="3" fill="#1a1a1a" stroke="none"/><circle cx="61" cy="42" r="3" fill="#1a1a1a" stroke="none"/></svg>
    <h1>Badger</h1>
  </div>
  <button class="btn btn-primary" onclick="printBadges()">Eksporter</button>
</div>

<div class="container">
  <div class="sidebar">

    <!-- 0. Skiltformat -->
    <div class="sidebar-section">
      <h3>Skiltformat</h3>
      <div class="size-row">
        <div>
          <label>Bredde mm</label>
          <input type="number" id="badgeWidth" value="92" onchange="renderBadges()">
        </div>
        <div>
          <label>Hoyde mm</label>
          <input type="number" id="badgeHeight" value="59" onchange="renderBadges()">
        </div>
      </div>
    </div>

    <!-- 1. Logo -->
    <div class="sidebar-section">
      <h3>Logo</h3>
      <div class="upload-area" id="logoArea" style="background:#f0f7f0;border-color:#8cb88c">
        <span class="upload-text">Last opp logo</span>
        <span class="upload-hint">.png / .jpg</span>
        <input type="file" accept="image/*" onchange="loadLogo(event)">
      </div>
      <div class="format-hint">
        Min. 300px bredde for god utskriftskvalitet.
      </div>
      <div id="logoControls" style="display:none">
        <label>Bredde</label>
        <div style="display:flex;align-items:center;gap:10px">
          <input type="range" id="logoWidth" min="20" max="100" value="100" oninput="updateLogoWidth()" style="flex:1">
          <span id="logoWidthVal" style="font-size:11px;min-width:32px">100%</span>
        </div>
        <label>Justering</label>
        <div class="layout-row">
          <button class="layout-btn" data-align="left" onclick="setLogoAlign('left', this)">Venstre</button>
          <button class="layout-btn active" data-align="center" onclick="setLogoAlign('center', this)">Sentrert</button>
          <button class="layout-btn" data-align="right" onclick="setLogoAlign('right', this)">H&oslash;yre</button>
        </div>
      </div>
    </div>

    <!-- 2. QR-kode med Generer/Last opp tabs -->
    <div class="sidebar-section">
      <h3>QR-kode</h3>
        <label style="margin-top:0">URL</label>
        <input type="url" id="qrUrl" placeholder="https://example.com" oninput="generateQR()">
        <div style="margin-top:10px">
          <label>Farge</label>
          <input type="color" id="qrColor" value="#000000" onchange="generateQR()" style="width:30px;height:30px;border:1px solid var(--border);background:var(--bg);cursor:pointer;padding:2px">
        </div>
        <div class="qr-style-row">
          <button class="qr-style-btn active" data-style="square" onclick="setQrStyle('square', this)">&#9632; Kantet</button>
          <button class="qr-style-btn" data-style="dots" onclick="setQrStyle('dots', this)">&#9679; Prikker</button>
          <button class="qr-style-btn" data-style="rounded" onclick="setQrStyle('rounded', this)">&#9673; Avrundet</button>
        </div>
        <div id="qrPreview" style="margin-top:12px;text-align:center"></div>
    </div>

    <!-- 3. Deltakere -->
    <div class="sidebar-section">
      <h3>Deltakere</h3>

      <div class="tabs">
        <button class="tab active" onclick="switchTab('excel', this)">Regneark</button>
        <button class="tab" onclick="switchTab('text', this)">Tekst</button>
      </div>

      <div class="tab-content active" id="tab-excel">
        <div class="upload-area" id="excelArea">
          <span class="upload-text">Last opp regneark</span>
          <span class="upload-hint">.xlsx / .csv</span>
          <input type="file" accept=".xlsx,.xls,.csv" onchange="loadExcel(event)">
        </div>
        <div class="excel-columns">
          Tre kolonner: <strong>Navn</strong>, <strong>Stilling</strong>, <strong>Firma</strong>
        </div>
      </div>

      <div class="tab-content" id="tab-text">
        <label>Navn, stilling og firma &mdash; tre linjer per person</label>
        <textarea id="inputList" placeholder="Runi Hagen&#10;Seniorr&aring;dgiver&#10;Nord Universitet&#10;&#10;Ola Nordmann&#10;Daglig leder&#10;Firma AS" oninput="parseTextInput()"></textarea>
      </div>
    </div>

    <!-- 4. Layout -->
    <div class="sidebar-section design-section" style="display:none">
      <h3>Layout</h3>
      <div class="layout-row">
        <button class="layout-btn active" data-layout="a" onclick="setLayout('a', this)">
          <span class="layout-icon">&#9638;</span>H&oslash;yrestilt
        </button>
        <button class="layout-btn" data-layout="c" onclick="setLayout('c', this)">
          <span class="layout-icon">&#9639;</span>Venstrestilt
        </button>
      </div>
      <div class="format-hint" id="layoutDesc">H&oslash;yrestilt &mdash; QR venstre, info h&oslash;yre</div>
    </div>

    <!-- 5. Skrift -->
    <div class="sidebar-section design-section" style="display:none">
      <h3>Skrift</h3>
      <label style="margin-top:0">Font</label>
      <select id="fontSelect" onchange="changeFont()">
        <option value="Lato" selected>Lato</option>
        <option value="Inter">Inter</option>
        <option value="Roboto">Roboto</option>
        <option value="Open Sans">Open Sans</option>
        <option value="Playfair Display">Playfair Display</option>
        <option value="Merriweather">Merriweather</option>
        <option value="Oswald">Oswald</option>
        <option value="Montserrat">Montserrat</option>
      </select>
      <div class="font-size-row" style="margin-top:12px">
        <div>
          <label>Navn pt</label>
          <input type="number" id="fontSize_name" value="18" min="6" max="30" onchange="renderBadges()">
        </div>
        <div>
          <label>Stilling pt</label>
          <input type="number" id="fontSize_commission" value="12" min="5" max="24" onchange="renderBadges()">
        </div>
        <div>
          <label>Firma pt</label>
          <input type="number" id="fontSize_company" value="9" min="5" max="20" onchange="renderBadges()">
        </div>
      </div>
    </div>


    <!-- 7. Liste -->
    <div class="sidebar-section">
      <div style="display:flex;justify-content:space-between;align-items:baseline;margin-bottom:10px">
        <h3 id="entriesHeader" style="margin-bottom:0">Liste (0)</h3>
        <button class="btn" onclick="clearAll()" style="padding:4px 8px;font-size:9px">Nullstill</button>
      </div>
      <div class="entries-list" id="entriesList"></div>
    </div>

  </div>

  <div class="preview-area" id="previewArea">
    <div class="empty-state">
    </div>
  </div>
</div>

<script>
let entries = [];
let qrDataUrl = null;
let logoDataUrl = null;
let currentLayout = 'a';
let currentFont = 'Lato';
let qrDotStyle = 'square';
let qrCodeInstance = null;
let logoWidthPct = 100;
let logoAlign = 'center';

const layoutDescriptions = {
  a: 'H\u00f8yrestilt \u2014 QR venstre, info h\u00f8yre',
  c: 'Venstrestilt \u2014 info venstre, QR h\u00f8yre'
};

function loadLogo(event) {
  const file = event.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = function(e) {
    logoDataUrl = e.target.result;
    const area = document.getElementById('logoArea');
    area.classList.add('has-file');
    area.innerHTML =
      `<img src="${logoDataUrl}" alt="Logo" style="max-width:200px;max-height:50px">
       <span class="upload-filename">${esc(file.name)}</span>
       <input type="file" accept="image/*" onchange="loadLogo(event)">`;
    document.getElementById('logoControls').style.display = '';
    renderBadges();
  };
  reader.readAsDataURL(file);
}

const countryMap = {
  'faroe': 'Faroe Islands',
  'finland': 'Finland',
  'finnish': 'Finland',
  'tampere': 'Finland',
  'lapland': 'Finland',
  'greenland': 'Greenland',
  'film gl': 'Greenland',
  'iceland': 'Iceland',
  'norway': 'Norway',
  'norwegian': 'Norway',
  'oslo': 'Norway',
  'arktisk': 'Norway',
  'midgard': 'Norway',
  'western norway': 'Norway',
  'eastern norway': 'Norway',
  'sweden': 'Sweden',
  'swedish': 'Sweden',
  'stockholm': 'Sweden',
  'gotland': 'Sweden',
  '\u00e5land': '\u00c5land',
  'film.ax': '\u00c5land',
  'denmark': 'Denmark',
  'danish': 'Denmark',
  'vision denmark': 'Denmark',
  'north finland': 'Finland',
  'west finland': 'Finland',
  'east finland': 'Finland',
  'southern sweden': 'Sweden',
};

function detectCountry(commission) {
  const lower = commission.toLowerCase();
  for (const [key, country] of Object.entries(countryMap)) {
    if (lower.includes(key)) return country;
  }
  return '';
}

function switchTab(tab, el) {
  const section = el.closest('.sidebar-section');
  section.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
  section.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
  el.classList.add('active');
  section.querySelector('#tab-' + tab).classList.add('active');
}

function switchQrTab(tab, el) {
  const section = el.closest('.sidebar-section');
  section.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
  section.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
  el.classList.add('active');
  section.querySelector('#qrtab-' + tab).classList.add('active');
}

function loadQR(event) {
  const file = event.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = function(e) {
    qrDataUrl = e.target.result;
    const area = document.getElementById('qrArea');
    area.classList.add('has-file');
    area.innerHTML =
      `<img src="${qrDataUrl}" alt="QR">
       <span class="upload-filename">${esc(file.name)}</span>
       <input type="file" accept="image/*" onchange="loadQR(event)">`;
    renderBadges();
  };
  reader.readAsDataURL(file);
}

function setQrStyle(style, el) {
  qrDotStyle = style;
  document.querySelectorAll('.qr-style-btn').forEach(b => b.classList.remove('active'));
  el.classList.add('active');
  generateQR();
}

function generateQR() {
  const url = document.getElementById('qrUrl').value.trim();
  const preview = document.getElementById('qrPreview');
  if (!url) {
    preview.innerHTML = '';
    qrDataUrl = null;
    renderBadges();
    return;
  }

  const color = document.getElementById('qrColor').value;

  const dotTypeMap = {
    square: 'square',
    dots: 'dots',
    rounded: 'rounded'
  };

  const opts = {
    width: 300,
    height: 300,
    data: url,
    dotsOptions: {
      color: color,
      type: dotTypeMap[qrDotStyle] || 'square'
    },
    backgroundOptions: {
      color: '#ffffff'
    },
    cornersDotOptions: {
      color: color
    },
    cornersSquareOptions: {
      color: color
    },
    qrOptions: {
      errorCorrectionLevel: 'M'
    }
  };

  if (qrCodeInstance) {
    preview.innerHTML = '';
  }

  qrCodeInstance = new QRCodeStyling(opts);

  const container = document.createElement('div');
  preview.innerHTML = '';
  preview.appendChild(container);
  qrCodeInstance.append(container);

  setTimeout(() => {
    const canvas = container.querySelector('canvas');
    if (canvas) {
      qrDataUrl = canvas.toDataURL('image/png');
      const img = document.createElement('img');
      img.src = qrDataUrl;
      img.style.cssText = 'max-width:80px;max-height:80px;border:1px solid #ccc';
      preview.innerHTML = '';
      preview.appendChild(img);
      renderBadges();
    }
  }, 200);
}

function updateLogoWidth() {
  logoWidthPct = document.getElementById('logoWidth').value;
  document.getElementById('logoWidthVal').textContent = logoWidthPct + '%';
  renderBadges();
}

function setLogoAlign(align, el) {
  logoAlign = align;
  el.closest('.layout-row').querySelectorAll('.layout-btn').forEach(b => b.classList.remove('active'));
  el.classList.add('active');
  renderBadges();
}

function setLayout(layout, el) {
  currentLayout = layout;
  document.querySelectorAll('.layout-btn').forEach(b => b.classList.remove('active'));
  el.classList.add('active');
  document.getElementById('layoutDesc').innerHTML = layoutDescriptions[layout];
  renderBadges();
}

function changeFont() {
  currentFont = document.getElementById('fontSelect').value;
  const link = document.getElementById('badgeFontLink');
  const fontName = currentFont.replace(/ /g, '+');
  link.href = `https://fonts.googleapis.com/css2?family=${fontName}:wght@300;400;700;900&display=swap`;
  setTimeout(renderBadges, 100);
}

function loadExcel(event) {
  const file = event.target.files[0];
  if (!file) return;

  const area = document.getElementById('excelArea');

  const reader = new FileReader();
  reader.onload = function(e) {
    const data = new Uint8Array(e.target.result);
    let opts = { type: 'array' };
    if (file.name.toLowerCase().endsWith('.csv')) {
      const text = new TextDecoder('utf-8').decode(data);
      const firstLine = text.split('\n')[0] || '';
      opts.FS = firstLine.includes(';') ? ';' : ',';
    }
    const workbook = XLSX.read(data, opts);
    const sheet = workbook.Sheets[workbook.SheetNames[0]];
    const rows = XLSX.utils.sheet_to_json(sheet, { header: 1 });

    let start = 0;
    if (rows.length > 0) {
      const first = rows[0].map(c => (c || '').toString().toLowerCase().trim());
      if (first.includes('navn') || first.includes('name') ||
          first.includes('stilling') || first.includes('title') ||
          first.includes('firma') || first.includes('company')) {
        start = 1;
      }
    }

    entries = [];
    for (let i = start; i < rows.length; i++) {
      const row = rows[i];
      if (!row || row.length < 1) continue;
      const name = (row[0] || '').toString().trim();
      if (!name) continue;
      const title = row.length >= 2 ? (row[1] || '').toString().trim() : '';
      const company = row.length >= 3 ? (row[2] || '').toString().trim() : '';
      entries.push({ name, title, company });
    }

    area.classList.add('has-file');
    area.innerHTML =
      `<span class="upload-filename">${esc(file.name)}</span>
       <span class="upload-hint">${entries.length} importert</span>
       <input type="file" accept=".xlsx,.xls,.csv" onchange="loadExcel(event)">`;

    renderEntries();
    renderBadges();
  };
  reader.readAsArrayBuffer(file);
}

function parseTextInput() {
  const raw = document.getElementById('inputList').value.trim();
  if (!raw) return;

  const lines = raw.split('\n').map(l => l.trim().replace(/,+$/, '')).filter(l => l.length > 0);

  entries = [];
  for (let i = 0; i < lines.length; i += 3) {
    const name = lines[i];
    const title = lines[i + 1] || '';
    const company = lines[i + 2] || '';
    if (name) {
      entries.push({ name, title, company });
    }
  }

  renderEntries();
  renderBadges();
}

function renderEntries() {
  const list = document.getElementById('entriesList');
  document.getElementById('entriesHeader').textContent = `Liste (${entries.length})`;

  list.innerHTML = entries.map((e, i) => `
    <div class="entry-item">
      <div>
        <div class="entry-name">${esc(e.name)}</div>
        ${e.title ? `<div class="entry-commission">${esc(e.title)}</div>` : ''}
        ${e.company ? `<div class="entry-country">${esc(e.company)}</div>` : ''}
      </div>
      <button class="remove-btn" onclick="removeEntry(${i})">x</button>
    </div>
  `).join('');
}

function esc(str) {
  const d = document.createElement('div');
  d.textContent = str;
  return d.innerHTML;
}

function removeEntry(index) {
  entries.splice(index, 1);
  renderEntries();
  renderBadges();
}

function clearAll() {
  entries = [];
  renderEntries();
  renderBadges();
}

function renderBadges() {
  const area = document.getElementById('previewArea');
  const w = document.getElementById('badgeWidth').value || 92;
  const h = document.getElementById('badgeHeight').value || 59;
  const fontName = document.getElementById('fontSize_name').value || 18;
  const fontComm = document.getElementById('fontSize_commission').value || 12;
  const fontCompany = document.getElementById('fontSize_company').value || 9;

  const hasContent = entries.length > 0 || logoDataUrl || qrDataUrl;
  if (!hasContent) {
    area.innerHTML = '<div class="empty-state"></div>';
    return;
  }

  document.querySelectorAll('.design-section').forEach(s => s.style.display = '');

  const badgesPerPage = 8;
  const qrImg = qrDataUrl ? `<img src="${qrDataUrl}" alt="QR">` : '';
  const layoutClass = `badge--layout-${currentLayout}`;
  const alignMap = { left: 'flex-start', center: 'center', right: 'flex-end' };
  const logoHtml = logoDataUrl
    ? `<div style="display:flex;justify-content:${alignMap[logoAlign]}"><img class="logo-img" src="${logoDataUrl}" alt="Logo" style="width:${logoWidthPct}%;height:auto"></div>`
    : '';

  const displayEntries = entries.length > 0
    ? entries
    : [{ name: 'Fornavn Etternavn', title: 'Stilling', company: 'Firma AS' }];

  let html = entries.length > 0
    ? `<div class="badge-count">${entries.length} navneskilt / ${Math.ceil(entries.length / badgesPerPage)} sider</div>`
    : '';

  for (let i = 0; i < displayEntries.length; i++) {
    if (i % badgesPerPage === 0) {
      if (i > 0) html += '</div>';
      html += '<div class="page">';
    }
    const e = displayEntries[i];
    html += `
      <div class="badge ${layoutClass}" style="width:${w}mm;height:${h}mm;">
        <div class="badge-top">
          ${logoHtml}
        </div>
        <div class="badge-bottom">
          <div class="qr">${qrImg}</div>
          <div class="info">
            <div class="name" style="font-family:'${currentFont}',sans-serif;font-size:${fontName}pt">${esc(e.name)}</div>
            ${e.title ? `<div class="commission" style="font-family:'${currentFont}',sans-serif;font-size:${fontComm}pt">${esc(e.title)}</div>` : ''}
            ${e.company ? `<div class="country" style="font-family:'${currentFont}',sans-serif;font-size:${fontCompany}pt">${esc(e.company)}</div>` : ''}
          </div>
        </div>
      </div>
    `;
  }
  html += '</div>';

  area.innerHTML = html;
}

function printBadges() {
  if (entries.length === 0) {
    alert('Ingen deltakere. Importer data forst.');
    return;
  }
  window.print();
}
</script>

</body>
</html>
